const fs = require('fs');
const htmlToText = require('html-to-text');
const path = './4897_.json'; // 更换为你的文件路径

fs.readFile(path, 'utf8', function (err, data) {
    if (err) {
        console.error(err);
    } else {
        const jsonObj = JSON.parse(data);
        
        // 提取题目 ID
        const exercise_id = jsonObj.data.exercise_id;
        
        // 输出题目 ID
        console.log('请帮我作答，并以json的格式回复给我题目编号与选项.Exercise ID:', exercise_id);
        
        // 提取问题
        const problems = jsonObj.data.problems;
    
        // 迭代问题数组
        for(let i = 0; i < problems.length; i++) {
            const problem = problems[i];
            const content = problem.content;
            
            // 提取问题编号
            const problemIndex = problem.index;
            //提取问题id
            const problemId = content.ProblemID;
            // 提取你需要的信息
            const problemType = content.ProblemType;
            let problemTypeText;
            switch(problemType) {
                case 1:
                    problemTypeText = '单选题';
                    break;
                case 2:
                    problemTypeText = '多选题';
                    break;
                case 6:
                    problemTypeText = '判断题';
                    break;
                default:
                    problemTypeText = '未知类型';
            }
            
            // 将Unicode编码的问题内容和选项解码为中文
            let body = content.Body.replace(/\\u/g, '%u');
            body = decodeURIComponent(body);
            
            // 使用html-to-text移除 HTML 标签
            body = htmlToText.convert(body);
            
            const options = content.Options.map(option => {
                const key = option.key;
                let value = option.value.replace(/\\u/g, '%u');
                value = decodeURIComponent(value);
                
                // 使用html-to-text移除 HTML 标签
                value = htmlToText.convert(value);
                
                return { key: key, value: value };
            });
            
            // 输出问题编号
            console.log('第' + (problemIndex) + '题');
            console.log('题目id: '+ problemId)
            console.log('类型：' + problemTypeText);
            console.log('内容：' + body);
            
            if(problemType === 6) {
                console.log('选项：' + options.map(option => option.value).join('，'));
            } else {
                options.forEach(option => {
                    console.log(option.key + ':' + option.value);
                });
            }

            console.log('---');
        }
    }
});
